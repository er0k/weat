<!doctype html>
<html lang="en">
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0">
    <meta charset="utf-8" lang="en">
    <title>weather</title>
</head>
<body>

<div id="services"></div>

<div id="place">
    <span id="city"></span>, <span id="state"></span>, <span id="country"></span>
</div>

<div id="weather">
    <h1 id="currentTemp"></h1>
    <h2 id="current"></h2>
    <img id="currentIcon" src="">

    <dl>
        <dt>wind</dt><dd id="wind"></dd>
        <dt>humidity</dt><dd id="humidity"></dd>
        <dt>pressure</dt><dd id="pressure"></dd>
        <dt>visibility</dt><dd id="visibility"></dd>
        <dt>precipitation</dt><dd id="precipitation"></dd>
    </dl>
</div>

</body>

<script>

const services = [
    { id: 2, name: "Open Weather Map" },
    { id: 3, name: "NOAA" },
];

const showServices = _=> {
    let list = "<ul>";
    services.map(service => list += `<li><a href="#${service.name}" onclick="showWeather(${service.id});">${service.name}</a></li>`);
    list += "</ul>";
    let servicesDiv = document.getElementById("services")
    servicesDiv.innerHTML = list;
}

showServices();

const getWeather = async serviceId => {
    let weatherResp = await fetch("w.php?s=" + serviceId);
    let contents = await weatherResp.json();
    return contents;
}

const showWeather = async serviceId => {
    let data = await getWeather(serviceId);
    console.log(serviceId, data);

    for (let item in data.location) {

        if (document.getElementById(item)) {
            console.log(item, data.location[item]);
            document.getElementById(item).textContent = data.location[item];
        }
    }

    for (let item in data.weather) {
        if (document.getElementById(item)) {
            if (item == "currentIcon") {
                document.getElementById(item).src = data.weather[item];
            } else {
                document.getElementById(item).textContent = data.weather[item];
            }
        }
    }
}

if (window.location.hash) {
    let presetService = services.find(service => service.name === decodeURI(window.location.hash).substr(1));
    showWeather(presetService.id);
}

</script>

</html>
